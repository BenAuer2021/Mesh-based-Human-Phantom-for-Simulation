# **MESH-BASED HUMAN (XCAT) PHANTOMS FOR SIMULATION (mesh50_XCAT)**

The **M**esh-based **XCAT** phantom (**mesh50_XCAT**) is developed and maintained by Auer Benjamin from the Brigham and Women's Hospital and Harvard Medical School, Boston, MA, USA.

**Contacts:** bauer@bwh.harvard.edu.

The **mesh50_XCAT** phantom is based on the 4D extended cardiac-torso digital anthropomorphic ([XCAT](https://otc.duke.edu/industry-investors/available-technologies/xcat/)) human phantom for a 50<sup>th</sup> percentile American male based on the [PeopleSize anthropometric database](https://openerg.com/).

The author acknowledge that the distribution free of charge of the **mesh50_XCAT** phantom is kindly permitted by the original developer team of the XCAT phantom.

Table of contents:
```diff
- 1. Objective and Background
- 2. Description
  - 2.1 STL-based phantoms (mesh50_XCAT)
  - 2.2 Voxelized version of the STL-based phantoms
- 3. Usage in GATE
  - 3.1 STL-based phantoms (mesh50_XCAT)
  - 3.2 Voxelized version of the STL-based phantoms 
```

# 1. Objective and Background

###### Objective
> The **mesh50_XCAT** phantom provides realistic description of the human body for use in medical research, such as imaging, dosimetry, or radiation therapy. Simulation of such phantoms via adequate software capable of modelling mesh-based structures can emulate realistic medical data close to those obtained for actual patients.

###### Background
The Geant4 application for tomographic emission (GATE) remains one of the most commonly used simulation toolkits for medical research - [GATE source page](http://www.opengatecollaboration.org) [^1]. GATE supports the simulation of Positron Emission Tomography (PET), Single Photon Emission Computed Tomography (SPECT), X-ray Computed Tomography (CT), optical, and Compton camera imaging, radiation therapy, and dosimetry in the same environment [^2]. 

Most of the simulation software allows building system and phantom geometries based on the combination of simple idealized volumes (i.e. primitives). However, primitives are limited to model accurately complex geometries. Recent GATE releases (version [8 and 9](http://www.opengatecollaboration.org)) alleviate these limitations by allowing the users to import triangulated surface meshes as stereo-lithography (STL) file format, thus enabling improved accuracy of simulation of phantom geometries.

Taking advantage of such capability, we developed an STL-based version of the XCAT digitial anthropomorphic phantom[^3][^4], named **mesh50_XCAT**, which provides an advanced anatomical description of the human body for simulation purposes.

In agreement with the original developer team of the XCAT phantom, we distribute below free of charge (*see attached files*) three versions of the **mesh50_XCAT** phantom with different lengths (**Head only**, **Head-Torso-Abdominal only**, and **Whole Body**). We provide below a detailled description of the usage in GATE of the phantoms. It is understandable that the **mesh50_XCAT** phantom can be used in any software capable of importing STL files (e.g. Geant4).

We refer readers interested on the generation, usage, and validation of the **mesh50_XCAT** phantom in the context of brain SPECT imaging to our previous publications. We kindly ask users to cite the following publications in their work,
> - Auer, B., Könik, A., Fromme, T.J., De Beenhouwer, J., Kalluri, K.S., Lindsay, C., Furenlid, L. R., Kuo, P.H. & King, M. A. (2022). Mesh Modelling of system geometry and anatomy phantoms for realistic GATE simulations and reconstruction, submitted for publication to Physics in Medicine and Biology.

> - Auer, B., Könik, A., Kalluri, K., De Beenhouwer, J., Furenlid, L. R., & King, M. A. (2018, November). Preliminary evaluation of surface mesh modeling of system geometry, anatomy phantom, and source activity for GATE simulations. In 2018 IEEE Nuclear Science Symposium and Medical Imaging Conference Proceedings (NSS/MIC) (pp. 1-3). IEEE.

An extended version of the **mesh50_XCAT** phantom was used in the following publications[^5][^6].

# 2. Description

## 2.1 STL-based phantoms (**mesh50_XCAT**)

We provide 3 versions of the **mesh50_XCAT** phantom with different lengths (**Whole Body**, **Head-Torso-Abdominal Only**, and **Head Only**) as showed on the figure below.

<p align="center">
<img width="645" alt="Screen Shot 2022-06-02 at 4 41 26 PM" src="https://user-images.githubusercontent.com/84809217/171734381-dd43d63c-b9fa-44b8-b05b-e19b0a865efa.png">
</p>
  
The 3 **mesh50_XCAT** phantom versions consist of the following structures,

- **Whole Body:**<br/>
  *Body, Brain, Skeleton, Liver, Lungs, Air Cavity and Bronchi Tree*. Note, the *Air Cavity* volume was generated by merging part of the throat, nasal and oral cavities, and trachea. These volumes were embedded into a structure, named *Body* reflecting the outer surface of the phantom. Body was generated by unification of the head, ears, chest, arms, and legs into a single volume.
  | Structures | Size (cm x cm x cm) | Volumes (cm<sup>3</sup>) | # of Triangles | STL file size (MB) |
  |    :---     |     :---:  |     :---:     |    :---:      |    :---:  |
  | Body   | 65.8 x 28.0 x 176.4   | 73,781.8  | 12,148 | 0.61 |
  | Skeleton   | 64.0 x 25.4 x 175.0  | 6,539.1  | 73,832 | 3.7 |   
  | Air Cavity   | 5.9 x 14.0 x 26.7  | 141.3  | 3,830 | 0.19 | 
  | Brain   | 13.0 x 16.9 x 13.8  | 1,322.8  | 7,518 | 0.38 | 
  | Bronchi Tree  | 18.3 x 9.8 x 10.8  | 5.2  | 5,306 | 0.26 | 
  | Liver   | 18.9 x 19.1 x 18.7  | 1,798.7  | 3,698 | 0.18 | 
  | Lungs   | 24.1 x 18.0 x 22.1  | 2,804.7  | 5,354 | 0.27 | 

  <p align="center">
  <img width="952" alt="Screen Shot 2022-06-02 at 5 04 18 PM" src="https://user-images.githubusercontent.com/84809217/171738071-79ae77d3-0ec6-4713-b0e9-b70489f9a0f5.png">
  </p>
  
- **Head-Torso-Abdominal Only:**<br/> 
  *Brain, Liver, Lungs, Bronchi Tree, Air Cavity* and Part of the *Body* and the *Skeleton* within the head, torso, and abdominal region. 
  | Structures | Size (cm x cm x cm) | Volumes (cm<sup>3</sup>) | # of Triangles | STL file size (MB) |
  |    :---     |     :---:  |     :---:     |    :---:      |    :---:  |
  | Body (Head-Torso-Abd)  | 65.8 x 28.0 x 95.6   | 53,869.5  | 15,502 | 0.77 |
  | Skeleton (Head-Torso-Abd)   | 64.0 x 25.4 x 94.8  | 4,644.3  | 61,582 | 3.1 |   
  | Air Cavity   | 5.9 x 14.0 x 26.7  | 141.3  | 3,830 | 0.19 | 
  | Brain   | 13.0 x 16.9 x 13.8  | 1,322.8  | 7,518 | 0.38 | 
  | Bronchi Tree  | 18.3 x 9.8 x 10.8  | 5.2  | 5,306 | 0.26 | 
  | Liver   | 18.9 x 19.1 x 18.7  | 1,798.7  | 3,698 | 0.18 | 
  | Lungs   | 24.1 x 18.0 x 22.1  | 2,804.7  | 5,354 | 0.27 | 

  <p align="center">
  <img width="963" alt="Screen Shot 2022-06-02 at 5 05 29 PM" src="https://user-images.githubusercontent.com/84809217/171738203-c567aeeb-069b-4de8-b30b-03a0196dbef1.png">
  </p>
 
- **Head Only:**<br/>
  *Brain* and Part of the *Body*, *Skeleton*, and *Air Cavity* within the head region.
  | Structures | Size (cm x cm x cm) | Volumes (cm<sup>3</sup>) | # of Triangles | STL file size (MB) |
  |    :---     |     :---:  |     :---:     |    :---:      |    :---:  |
  | Body (Head) | 34.1 x 24.8 x 25.6   | 5,476.5 | 2,004 | 0.10 |
  | Skeleton (Head)   | 21.8 x 20.2 x 24.9  | 1,000.7  | 13,156 | 0.66 |   
  | Air Cavity (Head)   | 5.1 x 9.6 x 12.4  | 103.1  | 1,736 | 0.19 | 
  | Brain   | 13.0 x 16.9 x 13.8  | 1,322.8  | 7,518 | 0.38 | 

  <p align="center">
  <img width="862" alt="Screen Shot 2022-06-02 at 5 06 06 PM" src="https://user-images.githubusercontent.com/84809217/171738291-5b417726-5ea3-452e-90b2-b5876546448a.png">
  </p>

## 2.2 Voxelized version of the STL-based phantoms

We also provide voxelized versions in interfile format (*16-bit unsigned integer, \*.i33 for raw data and \*.h33 for the header files*) of the 3 STL-based (**mesh50_XCAT**) phantoms described above. The voxelized phantoms can be used in attenuation correction for SPECT or PET reconstruction or as attenuation media or activity sources for GATE simulation.

<p align="center">
<img width="1201" alt="Screen Shot 2022-06-05 at 2 51 39 PM" src="https://user-images.githubusercontent.com/84809217/172066089-1b02d124-c95c-4026-87d2-d52d7747ccf1.png">
</p>

The *Body, Air Cavity, Brain, Bronchi Tree, Liver, Lungs, and Skeleton* regions were set of values from 1 to 7 by increment of 1.

The STL-based (**mesh50_XCAT**) phantoms were converted into voxelized phantoms following an approach similar to the one described in this paper[^7]. 

The voxelized attenuation phantoms were generated for a voxel size of 1 mm<sup>3</sup>. The Whole Body voxelized phantom is of 658x280x1764 mm<sup>3</sup> (size of 650 MB). The Head-Torso-Abdominal Only phantom is of 658x280x956 mm<sup>3</sup> (size of 352 MB). The Head Only phantom is of 338x248x256 mm<sup>3</sup> (size of 43 MB).

# 3. Usage in GATE

## 3.1 STL-based phantoms (**mesh50_XCAT**)

We provide a macro *'GateSTLPhantoms.mac'* to load and simulate in GATE the STL-based (**mesh50_XCAT**) attenuation phantoms along with the voxelized source defined above. 

We desribe the GATE command lines to import the whole-body **mesh50_XCAT** phantom. Importation process is similar for the *Head* and *Head-Torso-Abdominal* **mesh50_XCAT** phantoms. All the **mesh50_XCAT** internal structures (*Skeleton, Liver, Lungs, Bronchi Tree, Brain, and Air Cavity*) are part of the *Body* volume. The *Body* volume can be set as a sub-volume of the *world* or *SPECTHead*, or any other volumes emcompassing its size. Examples of biological material composition from the [**ICRP**](https://www.icrp.org) and the [**ICRU**](https://www.icru.org) of the STL-based human structures are provided below ([Geant4 ICRP110_HumanPhantoms Example](https://gitlab.physik.uni-kiel.de/geant4/geant4/-/blob/dab42d20185975fb0910dadfc6aa9998d9d9e06d/examples/advanced/ICRP110_HumanPhantoms/src/ICRP110PhantomMaterial_Male.cc), [GATE Example](https://github.com/OpenGATE/GateContrib/blob/master/dosimetry/Radiotherapy/example2/data/GateMaterials.db)). 


```ruby
/gate/SPECThead/daughters/name Body
/gate/SPECThead/daughters/insert tessellated
/gate/Body/geometry/setPathToSTLFile PATH_TO/WholeBody_Body.stl
/gate/Body/placement/setTranslation 0.0   0.0   0.0  cm
/gate/Body/setMaterial Water
/gate/Body/vis/setColor blue
/gate/Body/vis/forceSolid
/gate/Body/attachPhantomSD

/gate/Body/daughters/name Lung
/gate/Body/daughters/insert tessellated
/gate/Lung/geometry/setPathToSTLFile PATH_TO/WholeBody_Lungs.stl
/gate/Lung/placement/setTranslation 0.0   0.0   0.0  cm
/gate/Lung/setMaterial Lung
/gate/Lung/vis/setColor blue
/gate/Lung/vis/forceSolid
/gate/Lung/attachPhantomSD

/gate/Body/daughters/name Skeleton
/gate/Body/daughters/insert tessellated
/gate/Skeleton/geometry/setPathToSTLFile PATH_TO/WholeBody_Skeleton.stl
/gate/Skeleton/placement/setTranslation 0.0   0.0   0.0  cm
/gate/Skeleton/setMaterial SpineBone
/gate/Skeleton/vis/setColor cyan
/gate/Skeleton/vis/forceSolid
/gate/Skeleton/attachPhantomSD

/gate/Body/daughters/name Brain
/gate/Body/daughters/insert tessellated
/gate/Brain/geometry/setPathToSTLFile PATH_TO/WholeBody_Brain.stl
/gate/Brain/placement/setTranslation 0.0   0.0   0.0  cm
/gate/Brain/setMaterial Brain
/gate/Brain/vis/setColor cyan
/gate/Brain/vis/forceSolid
/gate/Brain/attachPhantomSD

/gate/Body/daughters/name Liver
/gate/Body/daughters/insert tessellated
/gate/Liver/geometry/setPathToSTLFile PATH_TO/WholeBody_Liver.stl
/gate/Liver/placement/setTranslation 0.0   0.0   0.0  cm
/gate/Liver/setMaterial Liver
/gate/Liver/vis/setColor cyan
/gate/Liver/vis/forceSolid
/gate/Liver/attachPhantomSD

/gate/Body/daughters/name AirCavity
/gate/Body/daughters/insert tessellated
/gate/AirCavity/geometry/setPathToSTLFile PATH_TO/WholeBody_AirCavity.stl
/gate/AirCavity/placement/setTranslation 0.0   0.0   0.0  cm
/gate/AirCavity/setMaterial Air
/gate/AirCavity/vis/setColor cyan
/gate/AirCavity/vis/forceSolid
/gate/AirCavity/attachPhantomSD
```

The *Bronchi Tree* is a subvolume of the Lung volume,
```ruby
/gate/Lung/daughters/name BronchiTree
/gate/Lung/daughters/insert tessellated
/gate/BronchiTree/geometry/setPathToSTLFile PATH_TO/WholeBody_BronchiTree.stl
/gate/BronchiTree/placement/setTranslation 0.0   0.0   0.0  cm
/gate/BronchiTree/setMaterial Water
/gate/BronchiTree/vis/setColor blue
/gate/BronchiTree/vis/forceSolid
/gate/BronchiTree/attachPhantomSD
``` 

## 3.2 Voxelized version of the STL-based phantoms

The voxelized phantoms (interfile format) can be loaded in GATE via the following command lines, where *'VoxSource'* is the source volume name,
```ruby
/gate/source/addSource                                            VoxSource voxel
/gate/source/VoxSource/reader/insert                              image
/gate/source/VoxSource/imageReader/translator/insert              linear
/gate/source/VoxSource/imageReader/linearTranslator/setScale      0.001 Bq
/gate/source/VoxSource/imageReader/readFile PATH_TO/VoxWholeBody_658x280x1764.h33 
# OR Head_Assembled_338x248x256 OR HeadTorsoAbd_Assembled_658x280x956
/gate/source/VoxSource/imageReader/verbose 1
/gate/source/VoxSource/gps/particle gamma
/gate/source/VoxSource/gps/angtype iso
/gate/source/VoxSource/gps/energy 140.5 keV # For Tc-99m
```
The default position of the voxelized source is in the 1<sup>st</sup> quarter, so the voxelized source has to be shifted over half its dimension in the negative direction on each axis. As the voxel size is 1 mm<sup>3</sup>, dimensions of the image (*provided in the file name*) need to be divided by two along X, Y, Z dimensions.

This results in the addition of the following two lines,

```ruby
/gate/source/VoxSource/setPosition -329.0 -140.0 -882.0 mm
/gate/source/list
```

The voxelized phantoms can also be used as attenuation map in GATE via the following command lines. Note, the voxelized phantom should **A)** not collide with any other system components and **B)** be contained entirely within its *'mother'* volume. The voxelized phantom can be a sub-volume of the *SPECThead* volume as shown below, 
```ruby
/gate/SPECThead/daughters/name VoxAttn
/gate/SPECThead/daughters/insert ImageRegularParametrisedVolume
/gate/VoxAttn/geometry/setImage PATH_TO/VoxWholeBody_658x280x1764.h33
/gate/VoxAttn/geometry/setRangeToMaterialFile AttnRange.dat
/gate/VoxAttn/placement/setTranslation  0. 0. 0. mm
/gate/VoxAttn/setSkipEqualMaterials 1
/gate/VoxAttn/attachPhantomSD
```
Indices in the voxelized image are translated into biological materials via the parameters defined in the *'AttnRange.dat'* file. For example, we recommend the following indices to materials conversion,

  | Image Indices | Human Structures | Biological materials |
  |    :---     |     :---:  |     :---:     |
  | 0 |  Volume surrounding the body region of the phantom  | *Air* |
  | 1   | Body  | *Water*  |
  | 2   | Air Cavity  | *Air*  | 
  | 3   | Brain  | *Brain*  |
  | 4   | Bronchi Tree  | *Air*  |
  | 5   | Liver  | *Liver*  |
  | 6   | Lungs  | *Lung*  |  
  | 7   | Skeleton  | *SpineBone*  |  
  
  Note, the biological materials are defined in the *'GateMaterials.db'* file available for download (*GATE_macros.zip*).

[^1]: Jan, S., Santin, G., Strul, D., Staelens, S., Assié, K., Autret, D., ... & Morel, C. (2004). GATE: a simulation toolkit for PET and SPECT. Physics in Medicine & Biology, 49(19), 4543.
[^2]: Sarrut, D., Bardiès, M., Boussion, N., Freud, N., Jan, S., Létang, J. M., ... & Buvat, I. (2014). A review of the use and potential of the GATE Monte Carlo simulation code for radiation therapy and dosimetry applications. Medical physics, 41(6Part1), 064301.
[^3]:Segars, W. P., Sturgeon, G., Mendonca, S., Grimes, J., & Tsui, B. M. (2010). 4D XCAT phantom for multimodality imaging research. Medical physics, 37(9), 4902-4915.
[^4]:Segars, W. P., & Tsui, B. M. (2009). MCAT to XCAT: The evolution of 4-D computerized phantoms for imaging research. Proceedings of the IEEE, 97(12), 1954-1968.
[^5]:Auer, B., Zeraatkar, N., Goding, J. C., Könik, A., Fromme, T. J., Kalluri, K. S., ... & King, M. A. (2021). Inclusion of quasi-vertex views in a brain-dedicated multi-pinhole SPECT system for improved imaging performance. Physics in Medicine & Biology, 66(3), 035007.
[^6]:Könik, A., Auer, B., De Beenhouwer, J., Kalluri, K., Zeraatkar, N., Furenlid, L. R., & King, M. A. (2019). Primary, scatter, and penetration characterizations of parallel-hole and pinhole collimators for I-123 SPECT. Physics in Medicine & Biology, 64(24), 245001.
[^7]:Patil, S. and Ravi, B. (2005) ‘Voxel-based representation, display and thickness analysis of intricate shapes’, in Ninth International Conference on Computer Aided Design and Computer Graphics (CAD-CG’05). IEEE, pp. 6-pp.

